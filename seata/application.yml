server:
  port: 7091  # Seata 控制台端口

spring:
  application:
    name: seata-server  # 服务名（与 Nacos 注册名一致）
  cloud:
logging:
  config: classpath:logback-spring.xml
  file:
    path: ${user.home}/logs/seata  # 日志存储路径
  extend:
    logstash-appender:
      destination: 127.0.0.1:4560
    kafka-appender:
      bootstrap-servers: 127.0.0.1:9092
      topic: logback_to_logstash

console:
  user:
    username: admin  # 控制台登录用户名
    password: admin  # 控制台登录密码

seata:
  # 核心配置：事务组、服务发现相关（2.0.0 必需）
  application-id: seata-server  # 应用ID（与 spring.application.name 一致）
  tx-service-group: default_tx_group  # 事务组名（必须与客户端一致）

  config:
    type: nacos
    nacos:
      server-addr: 47.109.137.128:8848  # Nacos 地址
      namespace: dev  # 命名空间（无引号）
      group: DEFAULT_GROUP  # 配置分组
      username: nacos  # Nacos 用户名
      password: nacos  # Nacos 密码
      refresh-enabled: true  # 启用配置自动刷新（2.0.0 新增）

  # 注册中心（Nacos）：服务注册与发现
  registry:
    type: nacos
    nacos:
      application: seata-server  # 注册到 Nacos 的服务名
      server-addr: 47.109.137.128:8848  # Nacos 地址
      namespace: dev  # 命名空间
      group: DEFAULT_GROUP  # 注册分组
      cluster: default  # 集群名（必须与客户端一致）
      username: nacos  # Nacos 用户名
      password: nacos  # Nacos 密码
      weight: 1.0  # 服务权重
      enable: true  # 启用注册中心

  # 存储配置（DB 模式，MySQL 8.x）
  store:
    mode: db  # 存储模式：db（数据库）
    db:
      dbType: mysql  # 关键：补充数据库类型（2.0.0 必需）
      driver-class-name: com.mysql.cj.jdbc.Driver  # MySQL 8.x 驱动
      url: jdbc:mysql://47.109.137.128:3306/seata?useUnicode=true&rewriteBatchedStatements=true&serverTimezone=Asia/Shanghai&useSSL=false&allowPublicKeyRetrieval=true
      user: root  # MySQL 用户名
      password: 1234qwerQWER  # MySQL 密码
      min-conn: 5  # 最小连接数
      max-conn: 100  # 最大连接数
      global-table: global_table  # 全局事务表
      branch-table: branch_table  # 分支事务表
      lock-table: lock_table  # 锁表
      distributed-lock-table: distributed_lock  # 分布式锁表
      query-limit: 100  # 查询限制条数
      max-wait: 5000  # 最大等待时间（ms）
      idle-timeout: 60000  # 连接空闲超时（ms，2.0.0 新增）
      connection-timeout: 30000  # 连接超时（ms，2.0.0 新增）

  # 服务器配置（TC 核心配置）
  server:
    service-port: 8091  # Seata TC 服务端口（客户端通信端口）
    enable-degrade: false  # 禁用降级（2.0.0 推荐）
    disable-global-transaction: false  # 启用全局事务（2.0.0 必需）
    retry-dead-threshold: 130000  # 重试死亡阈值（ms）
    max-commit-retry-timeout: -1  # 最大提交重试超时（-1 表示无限制）
    max-rollback-retry-timeout: -1  # 最大回滚重试超时（-1 表示无限制）

  # 事务组映射（核心！客户端通过事务组找服务端集群）
  service:
    vgroup-mapping:
      default_tx_group: default  # 事务组名 -> 集群名（与客户端一致）
    grouplist:
      default: 47.109.137.128:8091  # 集群对应的服务地址（TC 端口）
    enable-load-balance: true  # 启用负载均衡（2.0.0 推荐）

  # 安全配置（2.0.0 保持兼容）
  security:
    secretKey: SeataSecretKey0c382ef121d778043159209298fd40bf3850a017
    tokenValidityInMilliseconds: 1800000  # Token 有效期（30分钟）
    ignore:
      urls: /,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-fe/public/**,/api/v1/auth/login

  # 通信配置（2.0.0 优化网络参数）
  transport:
    type: TCP  # 传输协议
    server: NIO  # 服务端 IO 模式
    heartbeat: true  # 启用心跳检测
    serialization: seata  # 序列化方式（2.0.0 默认）
    compression: none  # 压缩方式（默认不压缩）
    connect-timeout: 3000  # 连接超时（ms）
    shutdown-timeout: 3000  # 关闭超时（ms）